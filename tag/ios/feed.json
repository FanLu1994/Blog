{
    "version": "https://jsonfeed.org/version/1",
    "title": "何妨吟啸且徐行 • All posts by \"ios\" tag",
    "description": "",
    "home_page_url": "https://fanlu.top",
    "items": [
        {
            "id": "https://fanlu.top/2024/01/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/pymobiledevice3/",
            "url": "https://fanlu.top/2024/01/03/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/pymobiledevice3/",
            "title": "pymobiledevice3",
            "date_published": "2024-01-03T13:46:09.000Z",
            "content_html": "<p>地址： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Rvcm9uejg4L3B5bW9iaWxlZGV2aWNlMw==\">https://github.com/doronz88/pymobiledevice3</span></p>\n<blockquote>\n<p>简介： 完全由 python3 实现，用于和 iphone 通信的工具，类 tidevice，支持 ios17</p>\n</blockquote>\n<p>！！windows 使用需要启动 itunes</p>\n<h2 id=\"检测连接设备\"><a class=\"markdownIt-Anchor\" href=\"#检测连接设备\">#</a> 检测连接设备</h2>\n<p><code> python -m pymobiledevice3 bonjour browse</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span> PS C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>fanlu<span class=\"token operator\">></span> python <span class=\"token parameter variable\">-m</span> pymobiledevice3 bonjour browse</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"ipv4\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token string\">\"192.168.31.243\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"ipv6\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token string\">\"fe80::1cb4:55c1:f952:1ca6\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">]</span>,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"lockdown_info\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token string\">\"CPUArchitecture\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arm64e\"</span>,</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token string\">\"DeviceName\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\u590f\">\\u590f</span><span class=\"token entity\" title=\"\\u76ee\">\\u76ee</span><span class=\"token entity\" title=\"\\u7684\">\\u7684</span>iphone12\"</span>,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token string\">\"HardwareModel\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"D53gAP\"</span>,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token string\">\"HumanReadableProductVersionString\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"17.1.2\"</span>,</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token string\">\"ProductName\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"iPhone OS\"</span>,</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token string\">\"ProductType\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"iPhone13,2\"</span>,</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token string\">\"ProductVersion\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"17.1.2\"</span>,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token string\">\"SupportedDeviceFamilies\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>,</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token string\">\"mac_address\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"8c:ec:7b:42:5a:90\"</span>,</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"8c:ec:7b:42:5a:90@fe80::8eec:7bff:fe42:5a90-supportsRP-19._apple-mobdev2._tcp.local.\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>命令行不如 tidevice 好用</p>\n<p>可能更适合代码来使用，使用代码来试一下。</p>\n<h2 id=\"使用代码方式\"><a class=\"markdownIt-Anchor\" href=\"#使用代码方式\">#</a> 使用代码方式</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>remote<span class=\"token punctuation\">.</span>remote_service_discovery <span class=\"token keyword\">import</span> RemoteServiceDiscoveryService  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>lockdown <span class=\"token keyword\">import</span> create_using_usbmux  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>syslog <span class=\"token keyword\">import</span> SyslogService  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Connecting via usbmuxd  </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>lockdown <span class=\"token operator\">=</span> create_using_usbmux<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> SyslogService<span class=\"token punctuation\">(</span>service_provider<span class=\"token operator\">=</span>lockdown<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>watch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\"># just print all syslog lines as is  </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># Or via remoted (iOS>=17)  </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># First, create a tunnel using:  </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#     $ sudo pymobiledevice3 remote start-tunnel  </span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># You can of course implement it yourself by copying the same pieces of code from:  </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#     https://github.com/doronz88/pymobiledevice3/blob/master/pymobiledevice3/cli/remote.py#L68  </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># Now you can simply connect to the created tunnel's host and port  </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>host <span class=\"token operator\">=</span> <span class=\"token string\">'fded:c26b:3d2f::1'</span>  <span class=\"token comment\"># randomized  </span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">65177</span>  <span class=\"token comment\"># randomized  </span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">with</span> RemoteServiceDiscoveryService<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> rsd<span class=\"token punctuation\">:</span>  </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> SyslogService<span class=\"token punctuation\">(</span>service_provider<span class=\"token operator\">=</span>rsd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>watch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\"># just print all syslog lines as is  </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>windows 不支持开启通道</li>\n</ul>\n<h2 id=\"ios17-mac-测试\"><a class=\"markdownIt-Anchor\" href=\"#ios17-mac-测试\">#</a> iOS17 mac 测试</h2>\n<p>![[Pasted image 20231228083943.png]]</p>\n<ol>\n<li>首先开启 remote 通道</li>\n</ol>\n<pre><code>sudo python3 -m pymobiledevice3 remote start-tunnel\n</code></pre>\n<ol start=\"2\">\n<li>然后在命令执行中，带上参数</li>\n</ol>\n<pre><code>python -m pymobiledevice3 developer dvt screenshot screen.png --rsd fdf2:3d44:d0::1 51528\n</code></pre>\n<p>文档中的部分命令使用过都可以正常使用。</p>\n<p>并且每个模块都被封装成了 python 类，因此可以在代码中很好的调用，例如</p>\n<h2 id=\"截图功能分析\"><a class=\"markdownIt-Anchor\" href=\"#截图功能分析\">#</a> 截图功能分析</h2>\n<p>代码部分：</p>\n<ul>\n<li>pymobiledevice3/cli/developer.py\n<ul>\n<li>line 256  dvt 执行的命令</li>\n<li>line 865</li>\n</ul>\n</li>\n<li>pymobiledevice3/services/screenshot.py</li>\n<li>pymobiledevice3/dvt/instruments/screenshot.py</li>\n</ul>\n<pre><code>with RemoteServiceDiscoveryService((hostname, RSD_PORT)) as rsd:\n</code></pre>\n<h2 id=\"使用python代码进行截图操作\"><a class=\"markdownIt-Anchor\" href=\"#使用python代码进行截图操作\">#</a> 使用 python 代码进行截图操作</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>remote<span class=\"token punctuation\">.</span>remote_service_discovery <span class=\"token keyword\">import</span> RemoteServiceDiscoveryService  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>lockdown <span class=\"token keyword\">import</span> create_using_usbmux  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>syslog <span class=\"token keyword\">import</span> SyslogService  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>dvt<span class=\"token punctuation\">.</span>instruments<span class=\"token punctuation\">.</span>screenshot <span class=\"token keyword\">import</span> Screenshot  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>dvt<span class=\"token punctuation\">.</span>dvt_secure_socket_proxy <span class=\"token keyword\">import</span> DvtSecureSocketProxyService  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>remote_server <span class=\"token keyword\">import</span> RemoteServer  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">from</span> pymobiledevice3<span class=\"token punctuation\">.</span>lockdown_service_provider <span class=\"token keyword\">import</span> LockdownServiceProvider  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Connecting via usbmuxd  </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># lockdown = create_using_usbmux()  </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># for line in SyslogService(service_provider=lockdown).watch():  </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#     # just print all syslog lines as is  </span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#     print(line)  </span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># screenShotService = ScreenshotService(lockdown=lockdown)  </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># screenShotService.take_screenshot()  </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># Or via remoted (iOS>=17)  </span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># First, create a tunnel using:  </span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#     $ sudo pymobiledevice3 remote start-tunnel  </span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># You can of course implement it yourself by copying the same pieces of code from:  </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#     https://github.com/doronz88/pymobiledevice3/blob/master/pymobiledevice3/cli/remote.py#L68  </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># Now you can simply connect to the created tunnel's host and port  </span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>host <span class=\"token operator\">=</span> <span class=\"token string\">'fdd3:399:962c::1'</span>  <span class=\"token comment\"># randomized  </span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">51572</span>  <span class=\"token comment\"># randomized  </span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">with</span> RemoteServiceDiscoveryService<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> rsd<span class=\"token punctuation\">:</span>  </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    out <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"wb\"</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">with</span> DvtSecureSocketProxyService<span class=\"token punctuation\">(</span>lockdown<span class=\"token operator\">=</span>rsd<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> dvt<span class=\"token punctuation\">:</span>  </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        out<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>Screenshot<span class=\"token punctuation\">(</span>dvt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>get_screenshot<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    out<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>一张图大概截图时间 0.7s（mac m2）</p>\n",
            "tags": [
                "工具",
                "ios"
            ]
        }
    ]
}