{
    "version": "https://jsonfeed.org/version/1",
    "title": "何妨吟啸且徐行 • All posts by \"网络\" tag",
    "description": "",
    "home_page_url": "https://fanlu.top",
    "items": [
        {
            "id": "https://fanlu.top/2023/08/27/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/grpcurl/",
            "url": "https://fanlu.top/2023/08/27/%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91/grpcurl/",
            "title": "grpcurl",
            "date_published": "2023-08-27T05:41:39.000Z",
            "content_html": "<h2 id=\"curl\"><a class=\"markdownIt-Anchor\" href=\"#curl\">#</a> cURL</h2>\n<p>curl 是一个常见的命令行工具，用来请求 web 服务器接口，c 就是 client 的意思。<br>\ncurl 支持的协议很多</p>\n<ul>\n<li>http</li>\n<li>https</li>\n<li>FTP</li>\n<li>SCP</li>\n<li>SMTP</li>\n<li>Websockect</li>\n</ul>\n<p>其使用方法可以参考这里： <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVhbnlpZmVuZy5jb20vYmxvZy8yMDE5LzA5L2N1cmwtcmVmZXJlbmNlLmh0bWw=\">https://www.ruanyifeng.com/blog/2019/09/curl-reference.html</span></p>\n<p>但是 grpc 是不支持的.</p>\n<h2 id=\"grpcurl\"><a class=\"markdownIt-Anchor\" href=\"#grpcurl\">#</a> grpcurl</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Z1bGxzdG9yeWRldi9ncnBjdXJs\">grpcurl</span> 就是用来支持 grpc 的一个工具。<br>\n支持功能包括：</p>\n<ul>\n<li>调用 RPC 接口，支持携带参数</li>\n<li>可以根据 proto 列出来所有的服务</li>\n<li>可以通过反射生成服务的描述</li>\n</ul>\n<h2 id=\"试用\"><a class=\"markdownIt-Anchor\" href=\"#试用\">#</a> 试用</h2>\n<h3 id=\"环境搭建\"><a class=\"markdownIt-Anchor\" href=\"#环境搭建\">#</a> 环境搭建</h3>\n<ul>\n<li>安装 go</li>\n<li>安装 grpcurl</li>\n<li>proto 生成相关（非必须）<br>\n这里就不赘述了。</li>\n</ul>\n<h3 id=\"启动grpc服务\"><a class=\"markdownIt-Anchor\" href=\"#启动grpc服务\">#</a> 启动 grpc 服务</h3>\n<p>首先本地起一个 grpc 服务，这里可以简单使用官方提供的模板。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> clone <span class=\"token parameter variable\">-b</span> v1.57.0 <span class=\"token parameter variable\">--depth</span> <span class=\"token number\">1</span> https://github.com/grpc/grpc-go</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> grpc-go/examples/helloworld</pre></td></tr></table></figure><p>修改服务，因为 grpcurl 需要服务器支持反射</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 修改 grpc-go/examples/helloworld/greeter_server/main.go</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>s <span class=\"token operator\">:=</span> grpc<span class=\"token punctuation\">.</span><span class=\"token function\">NewServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>reflection<span class=\"token punctuation\">.</span><span class=\"token function\">Register</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 添加这一行</span></pre></td></tr></table></figure><p>然后启动服务</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>go run main.go</pre></td></tr></table></figure><h3 id=\"使用grpcurl\"><a class=\"markdownIt-Anchor\" href=\"#使用grpcurl\">#</a> 使用 grpcurl</h3>\n<h4 id=\"列举服务\"><a class=\"markdownIt-Anchor\" href=\"#列举服务\">#</a> 列举服务</h4>\n<p>因为本地不是 tls 服务，需要加 - plaintext</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span> PS C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>fanlu<span class=\"token operator\">></span> grpcurl <span class=\"token parameter variable\">-plaintext</span> localhost:50051 list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>grpc.reflection.v1.ServerReflection</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>grpc.reflection.v1alpha.ServerReflection</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>helloworld.Greeter</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>// 指定service</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span> PS C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>fanlu<span class=\"token operator\">></span> grpcurl <span class=\"token parameter variable\">-plaintext</span> localhost:50051 list helloworld.Greeter</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>helloworld.Greeter.SayHello</pre></td></tr></table></figure><h4 id=\"描述协议\"><a class=\"markdownIt-Anchor\" href=\"#描述协议\">#</a> 描述协议</h4>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span> PS C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>fanlu<span class=\"token operator\">></span> grpcurl <span class=\"token parameter variable\">-plaintext</span> localhost:50051 describe helloworld.Greeter.SayHello</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>helloworld.Greeter.SayHello is a method:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>rpc SayHello <span class=\"token punctuation\">(</span> .helloworld.HelloRequest <span class=\"token punctuation\">)</span> returns <span class=\"token punctuation\">(</span> .helloworld.HelloReply <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"调用协议\"><a class=\"markdownIt-Anchor\" href=\"#调用协议\">#</a> 调用协议</h4>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span> PS C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>fanlu<span class=\"token operator\">></span> grpcurl <span class=\"token parameter variable\">-plaintext</span> localhost:50051 helloworld.Greeter.SayHello</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token string\">\"message\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Hello \"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"注意要区分大小写\"><a class=\"markdownIt-Anchor\" href=\"#注意要区分大小写\">#</a> 注意：要区分大小写！</h2>\n<p>更复杂的用法还没用过。</p>\n",
            "tags": [
                "工具",
                "网络"
            ]
        }
    ]
}